<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Snake Evo Test</title>

<style>
body{
    margin:0;
    background:#111;
    color:#fff;
    font-family:Arial, sans-serif;
    text-align:center;
}

h1{
    margin-top:10px;
}

canvas{
    background:#000;
    display:block;
    margin:10px auto;
    border:2px solid #555;
}

.controls{
    margin-top:10px;
}

button{
    font-size:20px;
    padding:15px 20px;
    margin:5px;
    border:none;
    border-radius:8px;
    background:#333;
    color:white;
}

button:active{
    background:#666;
}
</style>
</head>
<body>

<h1>Snake Evo Test</h1>

<canvas id="game" width="300" height="300"></canvas>

<div class="controls">
<br>
<button onclick="setDir(0,-1)">↑</button><br>
<button onclick="setDir(-1,0)">←</button>
<button onclick="setDir(1,0)">→</button><br>
<button onclick="setDir(0,1)">↓</button>
</div>

<script>
const canvas = document.getElementById("game");
const ctx = canvas.getContext("2d");

const grid = 15;
let count = 0;

let snake = {
    x:150,
    y:150,
    dx:grid,
    dy:0,
    cells:[],
    maxCells:4
};

let apple = {
    x:90,
    y:90
};

function getRandomInt(min,max){
    return Math.floor(Math.random()*(max-min))+min;
}

function loop(){
    requestAnimationFrame(loop);

    if(++count < 4){
        return;
    }

    count = 0;
    ctx.clearRect(0,0,canvas.width,canvas.height);

    snake.x += snake.dx;
    snake.y += snake.dy;

    if(snake.x < 0) snake.x = canvas.width-grid;
    if(snake.x >= canvas.width) snake.x = 0;
    if(snake.y < 0) snake.y = canvas.height-grid;
    if(snake.y >= canvas.height) snake.y = 0;

    snake.cells.unshift({x:snake.x,y:snake.y});

    if(snake.cells.length > snake.maxCells){
        snake.cells.pop();
    }

    ctx.fillStyle="red";
    ctx.fillRect(apple.x,apple.y,grid-1,grid-1);

    ctx.fillStyle="lime";

    snake.cells.forEach(function(cell,index){

        ctx.fillRect(cell.x,cell.y,grid-1,grid-1);

        if(cell.x === apple.x && cell.y === apple.y){
            snake.maxCells++;
            apple.x = getRandomInt(0,20)*grid;
            apple.y = getRandomInt(0,20)*grid;
        }

        for(let i=index+1;i<snake.cells.length;i++){
            if(cell.x === snake.cells[i].x &&
               cell.y === snake.cells[i].y){

                snake.x=150;
                snake.y=150;
                snake.cells=[];
                snake.maxCells=4;
                snake.dx=grid;
                snake.dy=0;

                apple.x=getRandomInt(0,20)*grid;
                apple.y=getRandomInt(0,20)*grid;
            }
        }

    });

}

function setDir(x,y){
    snake.dx=x*grid;
    snake.dy=y*grid;
}

document.addEventListener("keydown",function(e){

    if(e.key==="ArrowLeft") setDir(-1,0);
    if(e.key==="ArrowUp") setDir(0,-1);
    if(e.key==="ArrowRight") setDir(1,0);
    if(e.key==="ArrowDown") setDir(0,1);

});

requestAnimationFrame(loop);
</script>

</body>
</html>
